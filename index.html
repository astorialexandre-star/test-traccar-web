// Récupérer l'angle depuis Traccar (p.course est l'angle en degrés)
const angle = p.course || 0;

const customHtml = `
    <div class="navette-custom-icon">
        <div class="bus-circle">
            <img src="https://cdn-icons-png.flaticon.com/512/5193/5193688.png" width="30">
        </div>
        <div class="direction-arrow" style="transform: rotate(${angle - 90}deg);"></div>
    </div>
`;

const navetteIcon = L.divIcon({
    html: customHtml,
    className: '',
    iconSize: [60, 60],
    iconAnchor: [30, 30]
});

if (!navetteMarker) {
    navetteMarker = L.marker(newPos, { icon: navetteIcon }).addTo(map);
} else {
    navetteMarker.setLatLng(newPos);
    navetteMarker.setIcon(navetteIcon); // Mise à jour de l'icône et de l'angle
}
