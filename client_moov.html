<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DEMO - Test Mouvement Fluide</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-marker-slideto@1.0.0/leaflet-marker-slideto.js"></script>
    
    <style>
        #map { height: 100vh; width: 100%; }
        .navette-container { position: relative; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; }
        .bus-circle { width: 34px; height: 34px; background: white; border-radius: 50%; border: 3px solid #005587; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .bus-circle img { width: 20px !important; height: 20px !important; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = L.map('map').setView([45.8590, 6.6285], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        // VERIFICATION DANS LA CONSOLE
        if (L.Marker.prototype.slideTo) {
            console.log("✅ Plugin SlideTo chargé avec succès !");
        } else {
            console.error("❌ Plugin SlideTo NON détecté.");
        }

        let shuttle;
        const startPos = [45.8590, 6.6285];

        function move() {
            // On génère une position aléatoire proche
            const nextPos = [
                45.8590 + (Math.random() - 0.5) * 0.01,
                6.6285 + (Math.random() - 0.5) * 0.01
            ];

            const html = `<div class="navette-container"><div class="bus-circle"><img src="https://cdn-icons-png.flaticon.com/512/3448/3448339.png"></div></div>`;
            const icon = L.divIcon({ html: html, className: '', iconSize: [44, 44], iconAnchor: [22, 22] });

            if (!shuttle) {
                shuttle = L.marker(startPos, { icon: icon }).addTo(map);
            }

            // Déclenchement du mouvement fluide
            console.log("Déplacement vers :", nextPos);
            shuttle.slideTo(nextPos, {
                duration: 3000,
                keepAtCenter: false
            });
        }

        // Exécuter immédiatement puis toutes les 4 secondes
        move();
        setInterval(move, 4000);
    </script>
</body>
</html>
